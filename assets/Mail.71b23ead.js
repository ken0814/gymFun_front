import{_ as N,a as v,r as U,H as j,N as A,o as c,c as u,e as a,w as l,d as t,F as x,br as w,S as f,f as B,bn as V,p as z,i as P,j as D,l as H,bo as p,g as L}from"./index.8ed3af87.js";import{E as O}from"./EditCalendarOutlined.a9889629.js";import{_ as T}from"./Modal.0f26ea1d.js";import{_ as $}from"./Table.374ddf0e.js";import{_ as q}from"./Pagination.ec05cf21.js";import{_ as G}from"./Input.182010c0.js";import{a as J,_ as K}from"./FormItem.84d08bde.js";import"./Popover.db93f1ba.js";import"./Warning.4395cec0.js";import"./Select.bd173ae6.js";const m=d=>(z("data-v-4f7ba789"),d=d(),P(),d),Q=m(()=>t("div",{class:"flex justify-content-space-between",id:"section01"},[t("h1",null,"\u6211\u7684\u4FE1\u7BB1")],-1)),R=m(()=>t("h1",null,"\u67E5\u770B / \u56DE\u5FA9\u8A0A\u606F",-1)),W={class:"flex justify-content-flex-end",id:"btnSection"},X=D("\u9001\u51FA"),Y={id:"section02"},Z=m(()=>t("thead",null,[t("tr",null,[t("th",null,"\u5BC4\u4EF6\u4EBA"),t("th",null,"\u4FE1\u4EF6\u5167\u5BB9"),t("th",null,"\u6642\u9593"),t("th",null,"\u67E5\u770B / \u56DE\u5FA9")])],-1)),ee={key:1},te=m(()=>t("td",{colspan:"4",style:{"text-align":"center"}},"\u6C92\u6709\u4FE1\u4EF6",-1)),ne=[te],se={__name:"Mail",setup(d){const e=v({sender_id:"",senderMessage:"",messageContent:"",showModal:!1,submitting:!1}),i=v([]),r=U(1),_=5;j(()=>i.slice(r.value*_-_,r.value*_));const y=(o,n)=>{e.sender_id=o,e.showModal=!0,e.senderMessage=i[n].message.content},M=async()=>{e.submitting=!0;const o={content:e.messageContent};try{await w.post("/messages/"+e.sender_id,o),f.fire({icon:"success",title:"\u6210\u529F",text:"\u9001\u51FA\u6210\u529F"}),e.submitting=!1,e.showModal=!1}catch(n){f.fire({icon:"error",title:"\u5931\u6557",text:n.isAxiosError?n.response.data.message:n.message}),e.submitting=!1,e.showModal=!1}};return(async()=>{try{const{data:o}=await w.get("/messages");for(const n in o.result.messages)i.push({...o.result.messages[n]})}catch(o){f.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError&&o.response.data?o.response.data.message:"\u767C\u751F\u932F\u8AA4"})}})(),(o,n)=>{const g=G,h=J,b=H,C=K,S=T,k=A,E=$,F=q;return c(),u(x,null,[Q,a(S,{show:e.showModal,"onUpdate:show":n[2]||(n[2]=s=>e.showModal=s),"mask-closable":!0,preset:"card",style:{width:"500px"},id:"modal"},{default:l(()=>[R,a(C,{model:e,onSubmit:B(M,["prevent"])},{default:l(()=>[a(h,{path:"messageContent",label:"\u8A0A\u606F\u5167\u5BB9"},{default:l(()=>[a(g,{type:"textarea",placeholder:"\u8F38\u5165\u8A0A\u606F",value:e.senderMessage,"onUpdate:value":n[0]||(n[0]=s=>e.senderMessage=s),disabled:!0},null,8,["value"])]),_:1}),a(h,{path:"messageContent",label:"\u56DE\u8986\u8A0A\u606F"},{default:l(()=>[a(g,{type:"textarea",placeholder:"\u8F38\u5165\u8A0A\u606F",value:e.messageContent,"onUpdate:value":n[1]||(n[1]=s=>e.messageContent=s)},null,8,["value"])]),_:1}),t("div",W,[a(b,{color:"#475F77","attr-type":"submit"},{default:l(()=>[X]),_:1})])]),_:1},8,["model","onSubmit"])]),_:1},8,["show"]),t("div",Y,[a(E,{bordered:!1,"single-line":!1,id:"table"},{default:l(()=>[Z,t("tbody",null,[i.length>0?(c(!0),u(x,{key:0},V(i,(s,I)=>(c(),u("tr",{key:s._id},[t("td",null,p(s.senderProfile.name),1),t("td",null,p(s.message.content),1),t("td",null,p(s.message.date)+" "+p(s.sender._id),1),t("td",null,[a(b,{color:"#475F77",onClick:ae=>y(s.sender._id,I+(r.value-1)*_)},{default:l(()=>[a(k,{size:"25",color:"#fff",component:L(O)},null,8,["component"])]),_:2},1032,["onClick"])])]))),128)):(c(),u("tr",ee,ne))])]),_:1})]),a(F,{page:r.value,"onUpdate:page":n[3]||(n[3]=s=>r.value=s),"page-count":Math.ceil(i.length/_)},null,8,["page","page-count"])],64)}}},ge=N(se,[["__scopeId","data-v-4f7ba789"]]);export{ge as default};
